{"version":3,"sources":["storefront-sdk.min.js"],"names":["StorefrontSDK","config","Cart","storage","sendAsync","requiredConfigValues","idx","key","setCartStorage","cart","currency","set","field","toLowerCase","match","url","setCache","cartUrl","cart_url","encodeURIComponent","this","addItem","productID","quantity","self","Promise","resolve","reject","_addItem","get","items","isTest","existingItems","filter","item","product_id","length","existingItem","currencyMatch","isFinite","push","options","method","body","JSON","stringify","send","then","response","error","status","getCache","message","reference","open","removeCache","remove","checkout","token","appUrl","appHost","redirectUri","cart_id","window","location","removeItem","Products","cacheKey","product","localStorage","defaultConfig","cacheTimeout","parseInt","localStorageKey","ttl","isExpired","expires","now","Date","json","getItem","parse","value","data","setItem","purgeCache","purged","obj","clear","localStorageCacheKey","_sendAsyncRaw","fetch","contentType","headers","parsedJSON","testToken","Content-Type","undefined","products","arguments","toUpperCase"],"mappings":"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","file":"storefront-sdk.min.js","sourcesContent":["/*\n  Comecero Data Export version: 0.9.4\n  https://comecero.com\n  https://github.com/comecero/data-export\n  Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.\n*/\n\nvar StorefrontSDK=function(t){let e=function(t,e,n){const c=[\"appAlias\",\"appPage\"];for(const e in c){const n=c[e];if(!t.cart[n])throw\"missing required configuration value: cart.\"+n}const r=function(t){if(!t)return null;t.currency&&e.set(\"currency\",t.currency);for(let e in t)e.toLowerCase().match(/^customer/)&&delete t[e];return e.set(\"cart_url\",t.url),e.setCache(\"cart\",t)},o=function(e){let n=e+\"?formatted=true\";return t.expand&&t.expand.cart&&(n+=\"&expand=\"+encodeURIComponent(t.expand.cart)),n};this.addItem=function(c,s){let i=this;return new Promise(function(a,u){const h=function(i){const h=e.get(\"currency\");i||(i={items:[],url:\"https://\"+t.appHost+\"/api/v1/carts\"},h&&(i.currency=h)),e.isTest()&&!c.match(/\\.test/)&&(c+=\".test\");let l=o(i.url),f=i.items.filter(function(t){return t.product_id==c});if(f.length){let t=f[0];if(e.currencyMatch(i)&&(!isFinite(s)||t.quantity==s))return void a(i);t.quantity=s}else isFinite(s)||(s=1),i.items.push({product_id:c,quantity:s});h&&h!=i.currency&&(i.currency=h);let p={method:\"POST\",body:JSON.stringify(i)};n.send(l,p).then(function(t){a(r(t))},function(t){403==t.status||401==t.status?n.send(l,p).then(function(t){a(r(t))},function(t){u(t)}):u(t)})};i.get().then(h,function(t){h()})})},this.get=function(){return new Promise(function(t,c){let s=e.getCache(\"cart\"),i=e.get(\"cart_url\");const a=e.get(\"currency\");if(!s&&!i)return void c({status:404,message:\"No cart\",reference:\"rQTetYt\"});if(s&&e.currencyMatch(s))return void t(s);let u=o(i),h={method:\"GET\"};!a||s&&e.currencyMatch(s)||(h={method:\"POST\",body:JSON.stringify({currency:a})}),n.send(u,h).then(function(n){n.open?t(r(n)):(e.removeCache(\"cart\"),e.remove(\"cart_url\"),c({status:422,message:\"Cart not open\",reference:\"i23vM6g\"}))},function(t){c(t)})})},this.checkout=function(){const n=this;return new Promise(function(c,r){n.get().then(function(n){let r=e.get(\"token\");if(!n||!r||!n.open)return n&&!n.open&&(e.removeCache(\"cart\"),e.remove(\"cart_url\")),void c(!1);e.removeCache(\"cart\");let o=\"https://\"+t.appHost+\"/\"+t.cart.appAlias+\"/\",s=\"/\"+t.cart.appAlias+\"/\";t.cart.appPage&&(s+=\"#/\"+t.cart.appPage);let i=o+\"oauth/callback.html#access_token=\"+r+\"&cart_id=\"+n.cart_id+\"&redirect_uri=\"+encodeURIComponent(s);window.location=i,c(!0)},function(t){c(!1)})})},this.removeItem=function(t){return this.addItem(t,0)}},n=function(t,e,n){this.get=function(c){return new Promise(function(r,o){e.isTest()&&!c.match(/\\.test/)&&(c+=\".test\");let s=e.get(\"currency\"),i=\"product:\"+c+\":\"+s,a=e.getCache(i);if(a)return void r(a);let u=\"https://\"+t.appHost+\"/api/v1/products/\"+c+\"?formatted=true\";s&&(u+=\"&currency=\"+s),n.send(u,{method:\"GET\"}).then(function(t){!s&&t.currency&&(e.set(\"currency\",t.currency),i=\"product:\"+c+\":\"+t.currency),e.setCache(i,t),r(t)},function(t){o(t)})})}};if(!window.Promise||!window.localStorage)throw\"Browser does not support ES6\";const c=[\"appHost\",\"accountID\"],r={cacheTimeout:300};for(const e in r)t[e]||(t[e]=r[e]);for(const e in c){const n=c[e];if(!t[n])throw\"missing required configuration value: \"+n}t.cacheTimeout=parseInt(t.cacheTimeout),(!isFinite(t.cacheTimeout)||t.cacheTimeout<60)&&(t.cacheTimeout=60);const o=new function(t){const e=\"storefront-js-sdk-\"+t.accountID,n=t.cacheTimeout,c=function(t){const e=Date.now();return e>=(t?new Date(parseInt(t)):e)};if(this.get=function(t){const n=window.localStorage.getItem(e);return n?JSON.parse(n)[t]:null},this.set=function(t,n){const c=window.localStorage.getItem(e);let r=c?JSON.parse(c):{};return r[t]=n,window.localStorage.setItem(e,JSON.stringify(r)),n},this.remove=function(t){const n=window.localStorage.getItem(e);let c=n?JSON.parse(n):{};delete c[t],window.localStorage.setItem(e,JSON.stringify(c))},this.purgeCache=function(){let t=this.get(\"_cache\");if(!t)return;let e=!1;for(let n in t){let r=t[n];c(r.expires)&&(e=!0,delete t[n])}e&&this.set(\"_cache\",t)},this.getCache=function(t){this.purgeCache();let e=this.get(\"_cache\");if(!e)return null;let n=e[t];return n?n.data:null},this.setCache=function(t,e){this.purgeCache();const c=Date.now()+1e3*n;let r=this.get(\"_cache\");return r||(r={}),r[t]={expires:c,data:e},this.set(\"_cache\",r),e},this.removeCache=function(t){let e=this.get(\"_cache\");e&&e[t]&&(delete e[t],this.set(\"_cache\",e))},this.isTest=function(){const t=this.get(\"testToken\");return t&&t.length>0},this.currencyMatch=function(t){const e=this.get(\"currency\");return!e||!t||!t.currency||e==t.currency},this.clear=function(){const t=this.get(\"testToken\");let n={};t&&(n.testToken=t),window.localStorage.setItem(e,JSON.stringify(n)),window.localStorage.removeItem(localStorageCacheKey)},t.testToken){let e=this.get(\"token\");\"clear\"==t.testToken?(this.remove(\"testToken\"),e&&e.match(/\\.test\\./)&&this.clear()):(this.set(\"testToken\",t.testToken),e&&!e.match(/\\.test\\./)&&this.clear())}this.purgeCache()}(t),s=new function(t,e){const n=function(t,e){return e.cache||(e.cache=\"no-cache\"),new Promise(function(n,c){fetch(t,e).then(function(t){if(204!=t.status){var e=t.headers.get(\"content-type\");e.match(/\\/json$/i)?t.json().then(function(e){if(2==parseInt(t.status/100))n(e);else{const n=e.error?e.error:e;c({status:t.status,message:n.message,reference:n.reference})}},function(e){c({status:t.status,message:e,reference:\"9DrqfC8\"})}):c({status:t.status,message:\"Unexpected content type: \"+e,reference:\"8llaW8G\"})}else n(null)},function(t){c({status:-1,message:t.message,reference:\"7IGiWX0\"})})})};this.send=function(c,r){return new Promise(function(o,s){new Promise(function(c,r){let o=e.get(\"token\");if(o)return void c(o);let s=e.get(\"testToken\"),i=\"https://\"+t.appHost+\"/api/v1/auths/limited?show=token,expires_in_seconds&account_id=\"+t.accountID,a={method:\"POST\",headers:{\"Content-Type\":\"application/json\"}};s&&(\"public\"!=s&&(a.headers.Authorization=\"Bearer \"+s),i+=\"&test=true\"),n(i,a).then(function(t){t.token?c(e.set(\"token\",t.token)):r({status:403,message:\"Unable to obtain authorization\",reference:\"EobzCgb\"})},function(t){r(t)})}).then(function(t){null==r&&(r={}),null==r.headers&&(r.headers={}),r.headers[\"Content-Type\"]=\"application/json\",r.headers.Authorization=\"Bearer \"+t,n(c,r).then(function(t){o(t)},function(t){403!=t.status&&401!=t.status||e.clear(),s(t)})},function(t){s(t)})})}}(t,o);let i,a;this.products=function(){return i||(i=new n(t,o,s)),i},this.cart=function(){return a||(a=new e(t,o,s)),a},this.currency=function(){if(1==arguments.length){let t=arguments[0];null==t||\"string\"==typeof t&&0==t.length?o.remove(\"currency\"):\"string\"==typeof t&&(t=t.toUpperCase()).match(/^[A-Z]{3}$/)&&o.set(\"currency\",t)}const t=o.get(\"currency\");return t||null}};\n//# sourceMappingURL=storefront-sdk.min.js.map\n"]}