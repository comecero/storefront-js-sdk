{"version":3,"sources":["storefront-sdk.min.js"],"names":["StorefrontSDK","config","Cart","storage","sendAsync","setCartStorage","cart","currency","set","field","toLowerCase","match","url","setCache","cartUrl","cart_url","encodeURIComponent","this","addItem","productID","quantity","self","Promise","resolve","reject","_addItem","get","items","isTest","existingItems","filter","item","product_id","length","existingItem","currencyMatch","isFinite","push","options","method","body","JSON","stringify","send","then","response","error","status","getCache","message","reference","open","removeCache","remove","checkout","token","appUrl","appHost","redirectUri","cart_id","window","location","removeItem","Products","cacheKey","product","localStorage","requiredConfigValues","defaultConfig","cacheTimeout","key","idx","parseInt","localStorageKey","ttl","json","getItem","parse","value","data","setItem","purgeCache","purged","isExpired","expires","Date","now","obj","clear","localStorageCacheKey","_sendAsyncRaw","fetch","contentType","headers","parsedJSON","testToken","Content-Type","undefined","products","arguments","toUpperCase"],"mappings":"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","file":"storefront-sdk.min.js","sourcesContent":["/*\n  Comecero Data Export version: 0.9.3\n  https://comecero.com\n  https://github.com/comecero/data-export\n  Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.\n*/\n\nvar StorefrontSDK=function(t){let e=function(t,e,n){const c=function(t){if(!t)return null;t.currency&&e.set(\"currency\",t.currency);for(let e in t)e.toLowerCase().match(/^customer/)&&delete t[e];return e.set(\"cart_url\",t.url),e.setCache(\"cart\",t)},r=function(e){let n=e+\"?formatted=true\";return t.expand&&t.expand.cart&&(n+=\"&expand=\"+encodeURIComponent(t.expand.cart)),n};this.addItem=function(o,s){let i=this;return new Promise(function(a,u){const h=function(i){const h=e.get(\"currency\");i||(i={items:[],url:\"https://\"+t.appHost+\"/api/v1/carts\"},h&&(i.currency=h)),e.isTest()&&!o.match(/\\.test/)&&(o+=\".test\");let l=r(i.url),f=i.items.filter(function(t){return t.product_id==o});if(f.length){let t=f[0];if(e.currencyMatch(i)&&(!isFinite(s)||t.quantity==s))return void a(i);t.quantity=s}else isFinite(s)||(s=1),i.items.push({product_id:o,quantity:s});h&&h!=i.currency&&(i.currency=h);let p={method:\"POST\",body:JSON.stringify(i)};n.send(l,p).then(function(t){a(c(t))},function(t){403==t.status||401==t.status?n.send(l,p).then(function(t){a(c(t))},function(t){u(t)}):u(t)})};i.get().then(h,function(t){h()})})},this.get=function(){return new Promise(function(t,o){let s=e.getCache(\"cart\"),i=e.get(\"cart_url\");const a=e.get(\"currency\");if(!s&&!i)return void o({status:404,message:\"No cart\",reference:\"rQTetYt\"});if(s&&e.currencyMatch(s))return void t(s);let u=r(i),h={method:\"GET\"};!a||s&&e.currencyMatch(s)||(h={method:\"POST\",body:JSON.stringify({currency:a})}),n.send(u,h).then(function(n){n.open?t(c(n)):(e.removeCache(\"cart\"),e.remove(\"cart_url\"),o({status:422,message:\"Cart not open\",reference:\"i23vM6g\"}))},function(t){o(t)})})},this.checkout=function(){const n=this;return new Promise(function(c,r){n.get().then(function(n){let r=e.get(\"token\");if(!n||!r||!n.open)return n&&!n.open&&(e.removeCache(\"cart\"),e.remove(\"cart_url\")),void c(!1);e.removeCache(\"cart\");let o=\"https://\"+t.appHost+\"/\"+t.appAlias+\"/\",s=\"/\"+t.appAlias+\"/\";t.appPage&&(s+=\"#/\"+t.appPage);let i=o+\"oauth/callback.html#access_token=\"+r+\"&cart_id=\"+n.cart_id+\"&redirect_uri=\"+encodeURIComponent(s);window.location=i,c(!0)},function(t){c(!1)})})},this.removeItem=function(t){return this.addItem(t,0)}},n=function(t,e,n){this.get=function(c){return new Promise(function(r,o){e.isTest()&&!c.match(/\\.test/)&&(c+=\".test\");let s=e.get(\"currency\"),i=\"product:\"+c+\":\"+s,a=e.getCache(i);if(a)return void r(a);let u=\"https://\"+t.appHost+\"/api/v1/products/\"+c+\"?formatted=true\";s&&(u+=\"&currency=\"+s),n.send(u,{method:\"GET\"}).then(function(t){!s&&t.currency&&(e.set(\"currency\",t.currency),i=\"product:\"+c+\":\"+t.currency),e.setCache(i,t),r(t)},function(t){o(t)})})}};if(!window.Promise||!window.localStorage)throw\"Browser does not support ES6\";const c=[\"appHost\",\"accountID\",\"appAlias\",\"appPage\"],r={cacheTimeout:300};for(const e in r)t[e]||(t[e]=r[e]);for(const e in c){const n=c[e];if(!t[n])throw\"missing required configuration value: \"+n}t.cacheTimeout=parseInt(t.cacheTimeout),(!isFinite(t.cacheTimeout)||t.cacheTimeout<60)&&(t.cacheTimeout=60);const o=new function(t){const e=\"storefront-js-sdk-\"+t.accountID,n=t.cacheTimeout;if(this.get=function(t){const n=window.localStorage.getItem(e);return n?JSON.parse(n)[t]:null},this.set=function(t,n){const c=window.localStorage.getItem(e);let r=c?JSON.parse(c):{};return r[t]=n,window.localStorage.setItem(e,JSON.stringify(r)),n},this.remove=function(t){const n=window.localStorage.getItem(e);let c=n?JSON.parse(n):{};delete c[t],window.localStorage.setItem(e,JSON.stringify(c))},this.purgeCache=function(){const t=this.get(\"_cache\");if(!t)return;let e=!1;for(let n in t){let c=t[n];this.isExpired(c.expires)&&(e=!0,delete t[n])}e&&this.set(\"_cache\",t)},this.getCache=function(t){this.purgeCache();let e=this.get(\"_cache\");if(!e)return null;let n=e[t];return n?n.data:null},this.setCache=function(t,e){this.purgeCache();const c=Date.now()+1e3*n;let r=this.get(\"_cache\");return r||(r={}),r[t]={expires:c,data:e},this.set(\"_cache\",r),e},this.removeCache=function(t){let e=this.get(\"_cache\");e&&e[t]&&(delete e[t],this.set(\"_cache\",e))},this.isTest=function(){const t=this.get(\"testToken\");return t&&t.length>0},this.isExpired=function(t){const e=Date.now();return e>=(t?new Date(parseInt(t)):e)},this.currencyMatch=function(t){const e=this.get(\"currency\");return!e||!t||!t.currency||e==t.currency},this.clear=function(){const t=this.get(\"testToken\");let n={};t&&(n.testToken=t),window.localStorage.setItem(e,JSON.stringify(n)),window.localStorage.removeItem(localStorageCacheKey)},t.testToken){let e=this.get(\"token\");\"clear\"==t.testToken?(this.remove(\"testToken\"),e&&e.match(/\\.test\\./)&&this.clear()):(this.set(\"testToken\",t.testToken),e&&!e.match(/\\.test\\./)&&this.clear())}this.purgeCache()}(t),s=new function(t,e){const n=function(t,e){return e.cache||(e.cache=\"no-cache\"),new Promise(function(n,c){fetch(t,e).then(function(t){if(204!=t.status){var e=t.headers.get(\"content-type\");e.match(/\\/json$/i)?t.json().then(function(e){if(2==parseInt(t.status/100))n(e);else{const n=e.error?e.error:e;c({status:t.status,message:n.message,reference:n.reference})}},function(e){c({status:t.status,message:e,reference:\"9DrqfC8\"})}):c({status:t.status,message:\"Unexpected content type: \"+e,reference:\"8llaW8G\"})}else n(null)},function(t){c({status:-1,message:t.message,reference:\"7IGiWX0\"})})})};this.send=function(c,r){return new Promise(function(o,s){new Promise(function(c,r){let o=e.get(\"token\");if(o)return void c(o);let s=e.get(\"testToken\"),i=\"https://\"+t.appHost+\"/api/v1/auths/limited?show=token,expires_in_seconds&account_id=\"+t.accountID,a={method:\"POST\",headers:{\"Content-Type\":\"application/json\"}};s&&(\"public\"!=s&&(a.headers.Authorization=\"Bearer \"+s),i+=\"&test=true\"),n(i,a).then(function(t){t.token?c(e.set(\"token\",t.token)):r({status:403,message:\"Unable to obtain authorization\",reference:\"EobzCgb\"})},function(t){r(t)})}).then(function(t){null==r&&(r={}),null==r.headers&&(r.headers={}),r.headers[\"Content-Type\"]=\"application/json\",r.headers.Authorization=\"Bearer \"+t,n(c,r).then(function(t){o(t)},function(t){403!=t.status&&401!=t.status||e.clear(),s(t)})},function(t){s(t)})})}}(t,o);let i,a;this.products=function(){return i||(i=new n(t,o,s)),i},this.cart=function(){return a||(a=new e(t,o,s)),a},this.currency=function(){if(1==arguments.length){let t=arguments[0];null==t||\"string\"==typeof t&&0==t.length?o.remove(\"currency\"):\"string\"==typeof t&&(t=t.toUpperCase()).match(/^[A-Z]{3}$/)&&o.set(\"currency\",t)}const t=o.get(\"currency\");return t||null}};\n//# sourceMappingURL=storefront-sdk.min.js.map\n"]}