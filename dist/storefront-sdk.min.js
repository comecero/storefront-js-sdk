/*
  Comecero Data Export version: 0.9.5
  https://comecero.com
  https://github.com/comecero/data-export
  Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

var StorefrontSDK=function(t){let e=function(t,e,n){const c=["appAlias","appPage"];for(const e in c){const n=c[e];if(!t.cart[n])throw"missing required configuration value: cart."+n}const r=function(t){if(!t)return null;t.currency&&e.set("currency",t.currency);for(let e in t)e.toLowerCase().match(/^customer/)&&delete t[e];return e.set("cart_url",t.url),e.setCache("cart",t)},o=function(e){let n=e+"?formatted=true";return t.expand&&t.expand.cart&&(n+="&expand="+encodeURIComponent(t.expand.cart)),n};this.addItem=function(c,s){let i=this;return new Promise(function(a,u){const h=function(i){const h=e.get("currency");i||(i={items:[],url:"https://"+t.appHost+"/api/v1/carts"},h&&(i.currency=h)),e.isTest()&&!c.match(/\.test/)&&(c+=".test");let f=o(i.url),l=i.items.filter(function(t){return t.product_id==c});if(l.length){let t=l[0];if(e.currencyMatch(i)&&(!isFinite(s)||t.quantity==s))return void a(i);t.quantity=s}else isFinite(s)||(s=1),i.items.push({product_id:c,quantity:s});h&&h!=i.currency&&(i.currency=h);let p={method:"POST",body:JSON.stringify(i)};n.send(f,p).then(function(t){a(r(t))},function(t){403==t.status||401==t.status?n.send(f,p).then(function(t){a(r(t))},function(t){u(t)}):u(t)})};i.get().then(h,function(t){h()})})},this.get=function(){return new Promise(function(t,c){let s=e.getCache("cart"),i=e.get("cart_url");const a=e.get("currency");if(!s&&!i)return void c({status:404,message:"No cart",reference:"rQTetYt"});if(s&&e.currencyMatch(s))return void t(s);let u=o(i),h={method:"GET"};!a||s&&e.currencyMatch(s)||(h={method:"POST",body:JSON.stringify({currency:a})}),n.send(u,h).then(function(n){n.open?t(r(n)):(e.removeCache("cart"),e.remove("cart_url"),c({status:422,message:"Cart not open",reference:"i23vM6g"}))},function(t){c(t)})})},this.checkout=function(){const n=this;return new Promise(function(c,r){n.get().then(function(n){let r=e.get("token");if(!n||!r||!n.open)return n&&!n.open&&(e.removeCache("cart"),e.remove("cart_url")),void c(!1);e.removeCache("cart");let o="https://"+t.appHost+"/"+t.cart.appAlias+"/",s="/"+t.cart.appAlias+"/";t.cart.appPage&&(s+="#/"+t.cart.appPage);let i=o+"oauth/callback.html#access_token="+r+"&cart_id="+n.cart_id+"&redirect_uri="+encodeURIComponent(s);window.location=i,c(!0)},function(t){c(!1)})})},this.removeItem=function(t){return this.addItem(t,0)}},n=function(t,e,n){this.get=function(c){return new Promise(function(r,o){e.isTest()&&!c.match(/\.test/)&&(c+=".test");let s=e.get("currency"),i="product:"+c+":"+s,a=e.getCache(i);if(a)return void r(a);let u="https://"+t.appHost+"/api/v1/products/"+c+"?formatted=true";s&&(u+="&currency="+s),n.send(u,{method:"GET"}).then(function(t){!s&&t.currency&&(e.set("currency",t.currency),i="product:"+c+":"+t.currency),e.setCache(i,t),r(t)},function(t){o(t)})})}};if(!window.Promise||!window.localStorage)throw"Browser does not support ES6";const c=["appHost","accountID"],r={cacheTimeout:300};for(const e in r)t[e]||(t[e]=r[e]);for(const e in c){const n=c[e];if(!t[n])throw"missing required configuration value: "+n}t.cacheTimeout=parseInt(t.cacheTimeout),(!isFinite(t.cacheTimeout)||t.cacheTimeout<60)&&(t.cacheTimeout=60);const o=new function(t){const e="storefront-js-sdk-"+t.accountID,n=t.cacheTimeout,c=function(t){const e=Date.now();return e>=(t?new Date(parseInt(t)):e)};if(this.get=function(t){const n=window.localStorage.getItem(e);return n?JSON.parse(n)[t]:null},this.set=function(t,n){const c=window.localStorage.getItem(e);let r=c?JSON.parse(c):{};return r[t]=n,window.localStorage.setItem(e,JSON.stringify(r)),n},this.remove=function(t){const n=window.localStorage.getItem(e);let c=n?JSON.parse(n):{};delete c[t],window.localStorage.setItem(e,JSON.stringify(c))},this.purgeCache=function(){let t=this.get("_cache");if(!t)return;let e=!1;for(let n in t){let r=t[n];c(r.expires)&&(e=!0,delete t[n])}e&&this.set("_cache",t)},this.getCache=function(t){this.purgeCache();let e=this.get("_cache");if(!e)return null;let n=e[t];return n?n.data:null},this.setCache=function(t,e){this.purgeCache();const c=Date.now()+1e3*n;let r=this.get("_cache");return r||(r={}),r[t]={expires:c,data:e},this.set("_cache",r),e},this.removeCache=function(t){let e=this.get("_cache");e&&e[t]&&(delete e[t],this.set("_cache",e))},this.isTest=function(){const t=this.get("testToken");return t&&t.length>0},this.currencyMatch=function(t){const e=this.get("currency");return!e||!t||!t.currency||e==t.currency},this.clear=function(){const t=this.get("testToken");let n={};t&&(n.testToken=t),window.localStorage.setItem(e,JSON.stringify(n))},t.testToken){let e=this.get("token");"clear"==t.testToken?(this.remove("testToken"),e&&e.match(/\.test\./)&&this.clear()):(this.set("testToken",t.testToken),e&&!e.match(/\.test\./)&&this.clear())}this.purgeCache()}(t),s=new function(t,e){const n=function(t,e){return e.cache||(e.cache="no-cache"),new Promise(function(n,c){fetch(t,e).then(function(t){if(204!=t.status){var e=t.headers.get("content-type");e.match(/\/json$/i)?t.json().then(function(e){if(2==parseInt(t.status/100))n(e);else{const n=e.error?e.error:e;c({status:t.status,message:n.message,reference:n.reference})}},function(e){c({status:t.status,message:e,reference:"9DrqfC8"})}):c({status:t.status,message:"Unexpected content type: "+e,reference:"8llaW8G"})}else n(null)},function(t){c({status:-1,message:t.message,reference:"7IGiWX0"})})})};this.send=function(c,r){return new Promise(function(o,s){new Promise(function(c,r){let o=e.get("token");if(o)return void c(o);let s=e.get("testToken"),i="https://"+t.appHost+"/api/v1/auths/limited?show=token,expires_in_seconds&account_id="+t.accountID,a={method:"POST",headers:{"Content-Type":"application/json"}};s&&("public"!=s&&(a.headers.Authorization="Bearer "+s),i+="&test=true"),n(i,a).then(function(t){t.token?c(e.set("token",t.token)):r({status:403,message:"Unable to obtain authorization",reference:"EobzCgb"})},function(t){r(t)})}).then(function(t){null==r&&(r={}),null==r.headers&&(r.headers={}),r.headers["Content-Type"]="application/json",r.headers.Authorization="Bearer "+t,n(c,r).then(function(t){o(t)},function(t){403!=t.status&&401!=t.status||e.clear(),s(t)})},function(t){s(t)})})}}(t,o);let i,a;this.products=function(){return i||(i=new n(t,o,s)),i},this.cart=function(){return a||(a=new e(t,o,s)),a},this.currency=function(){if(1==arguments.length){let t=arguments[0];null==t||"string"==typeof t&&0==t.length?o.remove("currency"):"string"==typeof t&&(t=t.toUpperCase()).match(/^[A-Z]{3}$/)&&o.set("currency",t)}const t=o.get("currency");return t||null}};
//# sourceMappingURL=storefront-sdk.min.js.map
